#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "Running lint and test coverage checks..."

# Run lint in both services
echo "Linting enabler..."
cd enabler && npm run lint
if [ $? -ne 0 ]; then
  echo "❌ Lint failed in enabler"
  exit 1
fi

echo "Linting processor..."
cd ../processor && npm run lint
if [ $? -ne 0 ]; then
  echo "❌ Lint failed in processor"
  exit 1
fi

# Run test coverage in both services
echo "Running test coverage in enabler..."
cd ../enabler && npm run test:coverage
if [ $? -ne 0 ]; then
  echo "❌ Test coverage failed in enabler ( below 75% threshold)"
  exit 1
fi

echo "Running test coverage in processor..."
cd ../processor && npm run test:coverage
if [ $? -ne 0 ]; then
  echo "❌ Test coverage failed in processor ( below 75% threshold)"
  exit 1
fi

echo "✅ All checks passed (lint, coverage)!"
